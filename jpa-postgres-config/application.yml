spring:
  application:
    name: jpa-postgres-target
  datasource:
    url: jdbc:postgresql://postgres:5432/testdb
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver
  cloud:
    function:
      definition: solaceToPostgres
    stream:
      bindings:
        solaceToPostgres-in-0:
          destination: db-oracle-queues
          group: postgresTargetGroup
      binders:
        solace:
          type: solace
          defaultCandidate: true
          environment:
            solace:
              java:
                host: tcp://solace-broker:55555
                msgVpn: default
                clientUsername: default
                clientPassword: default

connector:
  databases:
    target:
      type: jpa
      dialect: postgresql
      url: jdbc:postgresql://postgres:5432/testdb
      username: postgres
      password: postgres
      driverClassName: org.postgresql.Driver
      pool:
        maxActive: 5
        maxIdle: 5

  workflows:
    - name: postgres-test-identification
      description: Consume Solace queue and write to test_identification
      source:
        type: solace
        queue: Q.ORACLE.TEST_IDENTIFICATION
      target:
        type: database
        databaseRef: target
        table: test_identification

    - name: postgres-test-metrics
      description: Consume Solace queue and write to test_metrics
      source:
        type: solace
        queue: Q.ORACLE.TEST_METRICS
      target:
        type: database
        databaseRef: target
        table: test_metrics

solace:
  connector:
    workflows:
      0:
        enabled: true
      1:
        enabled: true

management:
  simple:
    metrics:
      export:
        enabled: true

  datadog:
    metrics:
      export:
        enabled: false

  dynatrace:
    metrics:
      export:
        enabled: false

  influx:
    metrics:
      export:
        enabled: false

solace-persistence:

  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://postgres:5432/testdb
    username: postgres
    password: postgres
    hikari:
      initializationFailTimeout: -1
      connection-timeout: 5000
      maximum-pool-size: 5

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    database: postgresql
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        jdbc:
          batch_size: 50
        order_inserts: true
        order_updates: true
        generate_statistics: false

  sink:
    enabled: true

    # Queue(s) to consume from Solace
    queueNames:
      - Q.ORACLE.TEST_IDENTIFICATION
      - Q.ORACLE.TEST_METRICS

    # Persist messages using JPA
    dbWriteMode: jpa

    # Commit behavior
    commitInterval: 1
    commitTimeout: 5000

    # Reliability
    maxDbRetry: 3
    retryInterval: 5
    enableRetry: true
    retryCount: 3

    # Message handling
    acknowledgeOnSuccess: true
    acknowledgeOnFailure: false

    # Performance tuning
    writeBatchSize: 1
    writePoolSize: 5

    # Metadata
    enableTrackingId: true
    enableConnectorTimestamp: true
    enableDatabaseTimestamp: true
