spring:
  application:
    name: jpa-postgres-target

  datasource:
    driver-class-name: org.postgresql.Driver
    url: ${POSTGRES_JDBC_URL}
    username: ${POSTGRES_USERNAME}
    password: ${POSTGRES_PASSWORD}

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  cloud:
    config:
      enabled: false
      import-check:
        enabled: false

    # MUST exist for this connector image
    function:
      definition: solaceToPostgres

    stream:
      binders:
        solace:
          type: solace
          environment:
            solace:
              java:
                host: ${SOLACE_HOST}
                msgVpn: ${SOLACE_VPN}
                clientUsername: ${SOLACE_USERNAME}
                clientPassword: ${SOLACE_PASSWORD}

      bindings:
        solaceToPostgres-in-0:
          binder: solace
          destination: Q_POSTGRES_TARGET

# Connector runtime config
connector:
  databases:
    target:
      type: jpa
      dialect: postgres
      url: ${POSTGRES_JDBC_URL}
      username: ${POSTGRES_USERNAME}
      password: ${POSTGRES_PASSWORD}
      driverClassName: org.postgresql.Driver
      pool:
        maxActive: 5
        maxIdle: 5

  workflows:
    - name: postgres_sink
      enabled: true
      source:
        type: solace
        destinationType: queue
        queue: Q_POSTGRES_TARGET
      target:
        type: database
        databaseRef: target

# Some builds still require this "at least one workflow enabled" flag
solace:
  connector:
    workflows:
      0:
        enabled: true

# keep if you use connector_config.properties for mapping/rules
solace-persistence:
  config:
    propertiesFile: file:/app/external/spring/config/connector_config.properties

  sink:
    db-crud-mode: jpa
    jpaBatchMode: true
    jpaBatchSize: 25
    jpaMaxRetry: 3
    jpaRetryWaitMilliseconds: 3000
    payloadFormat: json

management:
  datadog:
    metrics:
      export:
        enabled: false
  