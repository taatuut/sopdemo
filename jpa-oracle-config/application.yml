spring:
  application:
    name: jpa-oracle-source

  cloud:
    vault:
      enabled: false

    # IMPORTANT: keep this set to avoid the connector framework hitting null definition paths
    # and to ensure the workflow setup function is part of the catalog.
    function:
      definition: setupWorkflow;mapPayloads

    stream:
      defaultBinder: solace

      binders:
        solace:
          type: solace
          environment:
            solace:
              java:
                host: ${SOLACE_HOST}
                msgVpn: ${SOLACE_VPN}
                clientUsername: ${SOLACE_USERNAME}
                clientPassword: ${SOLACE_PASSWORD}

        # DB binder used by the connector to poll/query the DB
        solace-db:
          type: db
          defaultCandidate: false

      bindings:
        # Workflow 0: TEST_IDENTIFICATION (DB -> Solace)
        input-0:
          destination: TEST_IDENTIFICATION
          binder: solace-db
          consumer:
            batch-mode: true
            concurrency: 1

        output-0:
          destination: db/oracle/test_identification
          binder: solace

        # Workflow 1: TEST_METRICS (DB -> Solace)
        input-1:
          destination: TEST_METRICS
          binder: solace-db
          consumer:
            batch-mode: true
            concurrency: 1

        output-1:
          destination: db/oracle/test_metrics
          binder: solace


# Solace broker connection (framework + management session)
solace:
  java:
    host: ${SOLACE_HOST}
    msgVpn: ${SOLACE_VPN}
    clientUsername: ${SOLACE_USERNAME}
    clientPassword: ${SOLACE_PASSWORD}
    connect-retries: -1
    reconnect-retries: -1

  connector:
    # CRITICAL: indexed workflows (not a YAML list)
    workflows:
      0:
        enabled: true
      1:
        enabled: true

    management:
      leader-election:
        mode: standalone
      session:
        host: ${SOLACE_HOST}
        msgVpn: ${SOLACE_VPN}
        clientUsername: ${SOLACE_USERNAME}
        clientPassword: ${SOLACE_PASSWORD}

    security:
      enabled: false


# DB connection used by the DB binder
solace-persistence:
  datasource:
    driver-class-name: oracle.jdbc.OracleDriver
    url: ${ORACLE_JDBC_URL}
    username: ${ORACLE_USERNAME}
    password: ${ORACLE_PASSWORD}
    hikari:
      initializationFailTimeout: -1
      connection-timeout: 5000

  source:
    dbQueryMode: jpa
    sendBatchSize: 1
    queryMax: 100
    triggerInterval: 2000


management:
  observations:
    enabled: false
  tracing:
    enabled: false
  datadog:
    metrics:
      export:
        enabled: false
  influx:
    metrics:
      export:
        enabled: false
  dynatrace:
    metrics:
      export:
        enabled: false
  otlp:
    metrics:
      export:
        enabled: false
  metrics:
    export:
      influx:
        enabled: false
      dynatrace:
        enabled: false
      otlp:
        enabled: false

debug: true
logging:
  level:
    root: INFO
    com.solace.connector.core: DEBUG
    com.solace.spring.cloud.stream.binders.db: DEBUG
    org.springframework.cloud.stream: DEBUG
    org.springframework.cloud.stream.binder: DEBUG
    org.springframework.cloud.stream.config: DEBUG